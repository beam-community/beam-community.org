---
import { NAV_LINKS, GITHUB_ORG_URL } from "../lib/constants";
import { Icon } from "astro-icon/components";
import ThemeToggle from "./ThemeToggle.astro";
---

<nav
  id="main-nav"
  class="fixed top-0 left-0 right-0 z-50 transition-all duration-300"
>
  <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="flex items-center justify-between h-16">
      <!-- Logo -->
      <a href="#" class="flex items-center gap-2 font-bold text-lg text-white nav-brand">
        <Icon name="lucide:hexagon" class="w-6 h-6" />
        BEAM Community
      </a>

      <!-- Desktop links -->
      <div class="hidden md:flex items-center gap-8">
        {
          NAV_LINKS.map((link) => (
            <a
              href={link.href}
              class="text-sm font-medium text-white/80 hover:text-white transition-colors nav-link"
            >
              {link.label}
            </a>
          ))
        }
        <a
          href={GITHUB_ORG_URL}
          target="_blank"
          rel="noopener noreferrer"
          class="text-white/80 hover:text-white transition-colors nav-link"
          aria-label="BEAM Community on GitHub"
        >
          <Icon name="simple-icons:github" class="w-5 h-5" />
        </a>
        <ThemeToggle />
      </div>

      <!-- Mobile menu button -->
      <div class="flex items-center gap-2 md:hidden">
        <ThemeToggle />
        <button
          id="mobile-menu-btn"
          class="text-white/80 hover:text-white"
          aria-label="Toggle menu"
          aria-expanded="false"
        >
          <Icon name="lucide:menu" class="w-6 h-6" id="menu-icon-open" />
          <Icon name="lucide:x" class="w-6 h-6 hidden" id="menu-icon-close" />
        </button>
      </div>
    </div>

    <!-- Mobile menu -->
    <div id="mobile-menu" class="hidden md:hidden pb-4">
      {
        NAV_LINKS.map((link) => (
          <a
            href={link.href}
            class="block py-2 text-sm font-medium text-white/80 hover:text-white transition-colors nav-link"
          >
            {link.label}
          </a>
        ))
      }
      <a
        href={GITHUB_ORG_URL}
        target="_blank"
        rel="noopener noreferrer"
        class="block py-2 text-sm font-medium text-white/80 hover:text-white transition-colors nav-link"
      >
        GitHub
      </a>
    </div>
  </div>
</nav>

<script>
  const nav = document.getElementById("main-nav")!;
  const btn = document.getElementById("mobile-menu-btn")!;
  const menu = document.getElementById("mobile-menu")!;
  const iconOpen = document.getElementById("menu-icon-open")!;
  const iconClose = document.getElementById("menu-icon-close")!;

  // Scroll-aware background
  function updateNav() {
    const isDark = document.documentElement.classList.contains("dark");
    if (window.scrollY > 50) {
      nav.classList.add("shadow-md");
      nav.classList.remove("bg-transparent");
      if (isDark) {
        nav.classList.add("bg-slate-900");
        nav.classList.remove("bg-white");
      } else {
        nav.classList.add("bg-white");
        nav.classList.remove("bg-slate-900");
      }
      nav.querySelectorAll(".nav-brand").forEach((el) => {
        el.classList.remove("text-white");
        el.classList.add(isDark ? "text-white" : "text-slate-900");
      });
      nav.querySelectorAll(".nav-link").forEach((el) => {
        el.classList.remove("text-white/80", "hover:text-white");
        if (isDark) {
          el.classList.remove("text-slate-600", "hover:text-slate-900");
          el.classList.add("text-slate-300", "hover:text-white");
        } else {
          el.classList.remove("text-slate-300");
          el.classList.add("text-slate-600", "hover:text-slate-900");
        }
      });
      btn.classList.remove("text-white/80", "hover:text-white");
      if (isDark) {
        btn.classList.remove("text-slate-600", "hover:text-slate-900");
        btn.classList.add("text-slate-300", "hover:text-white");
      } else {
        btn.classList.remove("text-slate-300");
        btn.classList.add("text-slate-600", "hover:text-slate-900");
      }
    } else {
      nav.classList.remove("bg-white", "bg-slate-900", "shadow-md");
      nav.classList.add("bg-transparent");
      nav.querySelectorAll(".nav-brand").forEach((el) => {
        el.classList.remove("text-slate-900");
        el.classList.add("text-white");
      });
      nav.querySelectorAll(".nav-link").forEach((el) => {
        el.classList.remove("text-slate-600", "hover:text-slate-900", "text-slate-300");
        el.classList.add("text-white/80", "hover:text-white");
      });
      btn.classList.remove("text-slate-600", "hover:text-slate-900", "text-slate-300");
      btn.classList.add("text-white/80", "hover:text-white");
    }
  }

  window.addEventListener("scroll", updateNav, { passive: true });
  updateNav();

  // Re-run on theme change to update scrolled nav colors
  const observer = new MutationObserver(() => updateNav());
  observer.observe(document.documentElement, {
    attributes: true,
    attributeFilter: ["class"],
  });

  // Mobile menu toggle
  btn.addEventListener("click", () => {
    const expanded = menu.classList.toggle("hidden");
    btn.setAttribute("aria-expanded", String(!expanded));
    iconOpen.classList.toggle("hidden");
    iconClose.classList.toggle("hidden");
  });

  // Close mobile menu on link click
  menu.querySelectorAll("a").forEach((link) => {
    link.addEventListener("click", () => {
      menu.classList.add("hidden");
      iconOpen.classList.remove("hidden");
      iconClose.classList.add("hidden");
      btn.setAttribute("aria-expanded", "false");
    });
  });
</script>
