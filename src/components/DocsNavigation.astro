---
import { getCollection } from "astro:content";
import { Icon } from "astro-icon/components";
import type { DocumentedProject } from "../lib/types";

interface Props {
  project: DocumentedProject;
  currentPath: string;
}

const SECTION_ORDER = ["overview", "guides", "resources"] as const;

const { project, currentPath } = Astro.props;

const allDocs = await getCollection("docs", (entry) => {
  return entry.data.project === project.slug;
});

const ordered = allDocs.sort((a, b) => {
  const sectionDiff =
    SECTION_ORDER.indexOf(a.data.section) - SECTION_ORDER.indexOf(b.data.section);
  if (sectionDiff !== 0) return sectionDiff;
  return a.data.order - b.data.order;
});

function getDocPath(entry: (typeof allDocs)[number]): string {
  const slug = entry.id.replace(`${project.slug}/`, "").replace(project.slug, "");
  if (!slug || slug === "index") {
    return `/projects/${project.slug}`;
  }
  return `/projects/${project.slug}/${slug}`;
}

const currentIndex = ordered.findIndex((e) => getDocPath(e) === currentPath);
const prev = currentIndex > 0 ? ordered[currentIndex - 1] : null;
const next = currentIndex < ordered.length - 1 ? ordered[currentIndex + 1] : null;
---

{(prev || next) && (
  <nav aria-label="Page navigation" class="mt-12 flex items-stretch gap-4 border-t border-slate-200 dark:border-slate-700 pt-6">
    {prev ? (
      <a
        href={getDocPath(prev)}
        class="group flex flex-1 items-center gap-3 rounded-lg border border-slate-200 dark:border-slate-700 px-4 py-3 transition-colors hover:border-purple-300 dark:hover:border-purple-700 hover:bg-purple-50 dark:hover:bg-purple-950/50"
      >
        <Icon
          name="lucide:arrow-left"
          class="h-4 w-4 shrink-0 text-slate-400 dark:text-slate-500 transition-colors group-hover:text-purple-600 dark:group-hover:text-purple-400"
        />
        <div class="min-w-0">
          <div class="text-xs text-slate-400 dark:text-slate-500">Previous</div>
          <div class="truncate text-sm font-medium text-slate-700 dark:text-slate-300 group-hover:text-purple-700 dark:group-hover:text-purple-400">
            {prev.data.title}
          </div>
        </div>
      </a>
    ) : (
      <div class="flex-1" />
    )}
    {next ? (
      <a
        href={getDocPath(next)}
        class="group flex flex-1 items-center justify-end gap-3 rounded-lg border border-slate-200 dark:border-slate-700 px-4 py-3 text-right transition-colors hover:border-purple-300 dark:hover:border-purple-700 hover:bg-purple-50 dark:hover:bg-purple-950/50"
      >
        <div class="min-w-0">
          <div class="text-xs text-slate-400 dark:text-slate-500">Next</div>
          <div class="truncate text-sm font-medium text-slate-700 dark:text-slate-300 group-hover:text-purple-700 dark:group-hover:text-purple-400">
            {next.data.title}
          </div>
        </div>
        <Icon
          name="lucide:arrow-right"
          class="h-4 w-4 shrink-0 text-slate-400 dark:text-slate-500 transition-colors group-hover:text-purple-600 dark:group-hover:text-purple-400"
        />
      </a>
    ) : (
      <div class="flex-1" />
    )}
  </nav>
)}
